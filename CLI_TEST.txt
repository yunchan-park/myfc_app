# 기본 설정
SERVER_URL="http://localhost:8000"; CONNECT_TIMEOUT=5; MAX_TIMEOUT=15

# 1. 팀 생성 (정보의 명확성 & 정보 교환의 명확성)
echo "== 팀 생성 =="
echo "클라이언트: 팀 이름, 설명, 유형, 비밀번호를 서버에 전송"
curl -v -X POST $SERVER_URL/teams/create \
  -H "Content-Type: application/json" \
  -d '{"name":"테스트팀3분","description":"발표용 팀입니다","type":"축구","password":"1234"}' | tee team.json
echo "서버: 생성된 팀의 ID 반환"
TEAM_ID=$(jq '.id' team.json); echo "팀 ID: $TEAM_ID" 

# 2. 팀 로그인 - 토큰 획득
echo "== 팀 로그인 =="
curl -X POST $SERVER_URL/teams/login \
  -H "Content-Type: application/json" \
  -d '{"name":"테스트팀3분","password":"1234","description":"","type":""}' | tee token.json
TOKEN=$(jq -r '.access_token' token.json); echo "인증 토큰: $TOKEN"

# 3. 선수 등록 (기능의 명확성)
echo "== 선수 등록 =="
echo "클라이언트: 선수 이름, 번호, 포지션, 팀 ID 전송"
curl -X POST $SERVER_URL/players/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"name":"김도영","number":10,"position":"FW","team_id":'$TEAM_ID'}' | tee player1.json
echo "서버: 생성된 선수 ID 반환"
PLAYER1_ID=$(jq '.id' player1.json); echo "선수 ID: $PLAYER1_ID"

# 4. 선수 정보 수정 (기능의 명확성)
echo "== 선수 정보 수정 =="
echo "클라이언트: 수정된 선수 정보 전송"
curl -X PUT $SERVER_URL/players/$PLAYER1_ID \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"name":"김도영수정","number":10,"position":"MF","team_id":'$TEAM_ID'}' | tee player1_update.json
echo "서버: 수정된 선수 정보 반환 - 이름과 포지션이 변경됨"

# 5. 경기 등록 (전체적인 등급)
echo "== 경기 등록 =="
echo "클라이언트: 경기 정보 전송"
curl -X POST $SERVER_URL/matches/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"date":"2025-06-01T15:00:00","opponent":"상대팀","score":"2:1","team_id":'$TEAM_ID',"player_ids":['$PLAYER1_ID'],"quarter_scores":[{"quarter":1,"our_score":1,"opponent_score":0},{"quarter":2,"our_score":1,"opponent_score":1}]}' | tee match.json
MATCH_ID=$(jq '.id' match.json); echo "경기 ID: $MATCH_ID"

# 6. 경기 상세 조회 (전체적인 등급)
echo "== 경기 상세 조회 =="
curl $SERVER_URL/matches/$MATCH_ID/detail \
  -H "Authorization: Bearer $TOKEN" | tee match_detail.json
echo "서버: 경기 상세 정보 반환 - 점수, 쿼터별 점수, 참가 선수 등 모든 경기 정보 포함"